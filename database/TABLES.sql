CREATE TABLE Laboratories (
    LabID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    LabName VARCHAR2(255) NOT NULL
);

CREATE TABLE ProductionLines (
    LineID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    LabID NUMBER NOT NULL,
    Specialization VARCHAR2(255) NOT NULL,
    FOREIGN KEY (LabID) REFERENCES Laboratories(LabID)
);

CREATE TABLE Employees (
    EmployeeID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    LineID NUMBER NOT NULL,
    ManagerID NUMBER,
    Firstname VARCHAR2(255) NOT NULL,
    Lastname VARCHAR2(255) NOT NULL,
    Role VARCHAR2(255) NOT NULL,
    Email VARCHAR2(255) NOT NULL,
    Password VARCHAR2(255) NOT NULL,
    FOREIGN KEY (LineID) REFERENCES ProductionLines(LineID),
    FOREIGN KEY (ManagerID) REFERENCES Employees(EmployeeID)
);

CREATE TABLE Medicines (
    MedicineID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    LineID NUMBER NOT NULL,
    TradeName VARCHAR2(255) NOT NULL,
    Chemical VARCHAR2(255) NOT NULL,
    Price NUMBER NOT NULL,
    TotalQuantity NUMBER DEFAULT 0 NOT NULL,
    FOREIGN KEY (LineID) REFERENCES ProductionLines(LineID)
);

CREATE TABLE ManufacturingDetails (
    ManufacturingID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    MedicineID NUMBER NOT NULL,
    ManufacturingDate DATE NOT NULL,
    ExpirationDate DATE NOT NULL,
    Quantity NUMBER NOT NULL,
    FOREIGN KEY (MedicineID) REFERENCES Medicines(MedicineID)
);

CREATE TABLE Distributors (
    DistributorID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    Firstname VARCHAR2(255) NOT NULL,
    Lastname VARCHAR2(255) NOT NULL,
    Email VARCHAR2(255) NOT NULL,
    Password VARCHAR2(255) NOT NULL,
    Governorate VARCHAR2(255) NOT NULL
);

CREATE TABLE PurchaseOrders (
    OrderID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    DistributorID NUMBER NOT NULL,
    MedicineID NUMBER NOT NULL,
    Quantity NUMBER,
    OrderDate DATE,
    Delivered NUMBER(1,0) DEFAULT 0 NOT NULL CHECK (Delivered IN (0,1)),
    FOREIGN KEY (DistributorID) REFERENCES Distributors(DistributorID),
    FOREIGN KEY (MedicineID) REFERENCES Medicines(MedicineID)
);

CREATE TABLE Invoices (
    InvoiceID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY NOT NULL,
    OrderID NUMBER NOT NULL,
    InvoiceDate DATE,
    Amount NUMBER,
    FOREIGN KEY (OrderID) REFERENCES PurchaseOrders(OrderID)
);

-- Ensure that each order can have only one invoice and vice versa
ALTER TABLE Invoices ADD CONSTRAINT UNIQUE_INVOICE_ORDERID UNIQUE (OrderID);
